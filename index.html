<!DOCTYPE html>
<html lang="uk">
<head>
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Q46BT674JH"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-Q46BT674JH');
</script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>3D Print Expert Pro</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg-body: #f5f5f7;
            --bg-card: #ffffff;
            --bg-darker: #fafafa;
            --text-main: #000000;
            --text-muted: #48484a;
            --primary: #0071e3;
            --border: #d2d2d7;
            --card-radius: 12px;
        }

        body.tg-mode {
            --bg-body: var(--tg-theme-bg-color, #f5f5f7);
            --bg-card: var(--tg-theme-secondary-bg-color, #ffffff);
            --bg-darker: var(--tg-theme-header-bg-color, #fafafa);
            --text-main: var(--tg-theme-text-color, #000000);
            --text-muted: var(--tg-theme-hint-color, #555555);
            --primary: var(--tg-theme-button-color, #0071e3);
            --border: rgba(128, 128, 128, 0.3);
        }

        body.dark-mode {
            --bg-body: #000000;
            --bg-card: #1c1c1e;
            --bg-darker: #121212;
            --text-main: #ffffff;
            --text-muted: #98989d;
            --border: #38383a;
        }

        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background: var(--bg-body); 
            margin: 0; 
            padding: 16px 16px 40px 16px; 
            color: var(--text-main);
            line-height: 1.4;
            transition: background 0.3s, color 0.3s;
            -webkit-tap-highlight-color: transparent;
        }

        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .main-title { text-align: center; margin-bottom: 20px; font-weight: 700; letter-spacing: -0.5px; margin-top: 10px; color: var(--text-main); }

        .dashboard { 
            display: grid; 
            grid-template-columns: 1fr; 
            gap: 16px; 
            max-width: 600px; 
            margin: 0 auto; 
        }

        .card { 
            background: var(--bg-card); 
            padding: 16px; 
            border-radius: var(--card-radius); 
            border: 1px solid var(--border);
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        }

        .inputs-row { display: flex; flex-wrap: wrap; gap: 12px; }
        .input-group { flex: 1 1 140px; margin-bottom: 4px; }

        .settings-card { background: var(--bg-darker); }
        .settings-header { display: flex; justify-content: space-between; align-items: center; cursor: pointer; padding: 4px 0; }
        .settings-header h3 { font-size: 0.9rem; text-transform: uppercase; letter-spacing: 0.5px; color: var(--text-main); opacity: 0.8; margin: 0; }
        .settings-content { display: none; flex-wrap: wrap; gap: 12px; padding-top: 16px; margin-top: 12px; border-top: 1px solid var(--border); }
        .settings-content.active { display: flex; }

        h3 { margin-bottom: 12px; font-size: 1rem; font-weight: 600; color: var(--text-main); }

        .info-card { background: var(--bg-darker); font-size: 0.9rem; margin-top: 10px;}
        .info-card p { margin: 0 0 10px 0; color: var(--text-main); opacity: 0.85; line-height: 1.5; }
        .info-card strong { color: var(--text-main); font-weight: 700; opacity: 1; }

        label { display: block; margin-bottom: 6px; font-size: 0.8rem; font-weight: 600; color: var(--text-main); opacity: 0.8; }
        input, select { width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 10px; background: var(--bg-card); color: var(--text-main); font-size: 1rem; outline: none; box-sizing: border-box; appearance: none; font-weight: 500; }
        input:focus, select:focus { border-color: var(--primary); }

        .footer-container { display: grid; grid-template-columns: 1fr; gap: 16px; }
        .detail-item { display: flex; justify-content: space-between; padding: 8px 0; font-size: 0.95rem; border-bottom: 1px solid var(--border); color: var(--text-main); }
        .detail-item:last-child { border-bottom: none; }
        .detail-item span:last-child { font-weight: 600; }

        .summary-card { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; background: var(--text-main); color: var(--bg-card); padding: 20px; border-radius: var(--card-radius); align-items: center; }
        .stat-box { text-align: center; }
        .stat-box label { font-size: 0.75rem; opacity: 0.8; color: var(--bg-card); font-weight: 500;} 
        .stat-box .price { font-size: 1.15rem; font-weight: 700; display: block; margin-top: 4px; }
        .stat-box.profit-box .price { color: #34c759; }
        body.dark-mode .stat-box.profit-box .price, body.tg-mode .stat-box.profit-box .price { color: #30d158; }

        /* –°—Ç–∏–ª—å –¥–ª—è —Ü—ñ–Ω–∏ –∑–∞ —à—Ç—É–∫—É (–º–∞–ª–µ–Ω—å–∫–∏–π —Ç–µ–∫—Å—Ç) */
        .price-per-item { font-size: 0.75rem; opacity: 0.9; font-weight: 400; display: block; margin-top: 2px; }

        .chevron::after { content: '‚Üì'; font-size: 0.8rem; margin-left: 8px; transition: transform 0.2s; display: inline-block; }
        .active-chevron::after { transform: rotate(180deg); }

        .tab-btn { flex: 1; padding: 10px; border: none; background: transparent; color: var(--text-main); opacity: 0.6; border-radius: 8px; font-weight: 600; cursor: pointer; transition: 0.2s; }
        .tab-btn.active { background: var(--primary); color: #fff; opacity: 1; }
    </style>
</head>
<body>

<div style="display: flex; gap: 10px; margin-bottom: 20px; background: var(--bg-card); padding: 5px; border-radius: 12px; border: 1px solid var(--border);">
    <button onclick="switchTab('calc')" id="btn-calc" class="tab-btn active">üßÆ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</button>
    <button onclick="switchTab('lib')" id="btn-lib" class="tab-btn">üìö –ü–ª–∞—Å—Ç–∏–∫–∏</button>
</div>

<button class="theme-toggle" onclick="toggleTheme()" id="themeBtn">üåô</button>

<div id="tab-calc">
    <h1 class="main-title">3D Print Studio</h1>
    <div class="dashboard">
        <main class="card">
            <h3>–ü–∞—Ä–∞–º–µ—Ç—Ä–∏ –º–æ–¥–µ–ª—ñ</h3>
            <div class="inputs-row">
                <div class="input-group">
                    <label>–ú–∞—Ç–µ—Ä—ñ–∞–ª</label>
                    <select id="materialType" onchange="loadMaterialPrice()">
                        <option value="PLA">PLA</option>
                        <option value="PETG">PETG</option>
                        <option value="ABS">ABS / ASA</option>
                        <option value="TPU">TPU</option>
                        <option value="Custom">Custom</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>–ö—ñ–ª—å–∫—ñ—Å—Ç—å (—à—Ç)</label>
                    <input type="number" inputmode="decimal" id="quantity" oninput="calculate()" placeholder="1" value="1">
                </div>
                <div class="input-group">
                    <label>–í–∞–≥–∞ (–≥)</label>
                    <input type="number" inputmode="decimal" id="weight" oninput="calculate()" placeholder="0">
                </div>
                <div class="input-group">
                    <label>–ß–∞—Å (–≥–æ–¥)</label>
                    <input type="number" inputmode="decimal" id="hours" oninput="calculate()" placeholder="0">
                </div>
            </div>
        </main>

        <section class="card settings-card">
            <div class="settings-header" onclick="toggleSettings()">
                <h3>–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Ç–∞—Ä–∏—Ñ—ñ–≤ (<span id="selected-material-label">PLA</span>)</h3>
                <span id="chevron" class="chevron"></span>
            </div>
            <div id="settingsContent" class="settings-content">
                <div class="input-group">
                    <label>–¶—ñ–Ω–∞ –∑–∞ –∫–≥ (‚Ç¥)</label>
                    <input type="number" inputmode="decimal" id="priceKg" oninput="saveManualPrice()">
                </div>
                <div class="input-group">
                    <label>–¢–∞—Ä–∏—Ñ –∫–í—Ç (‚Ç¥)</label>
                    <input type="number" inputmode="decimal" id="priceKwt" oninput="calculate()">
                </div>
                <div class="input-group">
                    <label>–ü–æ—Ç—É–∂–Ω—ñ—Å—Ç—å (–í—Ç)</label>
                    <input type="number" inputmode="decimal" id="power" oninput="calculate()">
                </div>
                <div class="input-group">
                    <label>–ù–∞—Ü—ñ–Ω–∫–∞ (%)</label>
                    <input type="number" inputmode="decimal" id="markup" oninput="calculate()">
                </div>
            </div>
        </section>

        <div class="footer-container">
            <div class="card detail-card">
                <h3>–î–µ—Ç–∞–ª—ñ–∑–∞—Ü—ñ—è</h3>
                <div class="detail-item"><span>–ü–ª–∞—Å—Ç–∏–∫</span><span id="res-material">0 ‚Ç¥</span></div>
                <div class="detail-item"><span>–ï–Ω–µ—Ä–≥—ñ—è</span><span id="res-energy">0 ‚Ç¥</span></div>
                <div class="detail-item"><span>–ê–º–æ—Ä—Ç–∏–∑–∞—Ü—ñ—è (10%)</span><span id="res-amortization">0 ‚Ç¥</span></div>
            </div>

            <div class="summary-card">
                <div class="stat-box"><label>–°–æ–±—ñ–≤–∞—Ä—Ç—ñ—Å—Ç—å</label><span id="total-cost" class="price">0 ‚Ç¥</span></div>
                <div class="stat-box"><label>–¶—ñ–Ω–∞ –ø—Ä–æ–¥–∞–∂—É</label><span id="sell-price" class="price">0 ‚Ç¥</span></div>
                <div class="stat-box profit-box"><label>–ü—Ä–∏–±—É—Ç–æ–∫</label><span id="profit" class="price">0 ‚Ç¥</span></div>
            </div>
        </div>

        <section class="card info-card">
            <h3>‚ÑπÔ∏è –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ —Å–µ—Ä–≤—ñ—Å</h3>
            <p>–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –¥–æ–¥–∞—î <strong>10% –∞–º–æ—Ä—Ç–∏–∑–∞—Ü—ñ—ó</strong> –æ–±–ª–∞–¥–Ω–∞–Ω–Ω—è –¥–æ –≤–∞—Ä—Ç–æ—Å—Ç—ñ –º–∞—Ç–µ—Ä—ñ–∞–ª—ñ–≤ —Ç–∞ –µ–Ω–µ—Ä–≥—ñ—ó.</p>
            <p>–Ø–∫—â–æ –≤–∏ –≤–∫–∞–∑–∞–ª–∏ –∫—ñ–ª—å–∫—ñ—Å—Ç—å > 1, —Å–∏—Å—Ç–µ–º–∞ –ø–æ–∫–∞–∂–µ –≤–∞—Ä—Ç—ñ—Å—Ç—å –æ–¥–Ω—ñ—î—ó —à—Ç—É–∫–∏ –ø—ñ–¥ –∑–∞–≥–∞–ª—å–Ω–æ—é —Å—É–º–æ—é.</p>
        </section>

    </div>
</div>

<div id="tab-lib" style="display: none;">
    <h2 style="text-align:center; margin-bottom: 20px; font-weight: 700;">–î–æ–≤—ñ–¥–Ω–∏–∫ –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä</h2>
    
    <div class="card" style="margin-bottom: 16px; border-left: 5px solid #34c759;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
            <h3 style="margin:0;">PLA</h3>
            <span style="background:#e8f8ed; color:#34c759; padding:4px 8px; border-radius:6px; font-size:0.8rem; font-weight:600;">–õ–µ–≥–∫–∏–π</span>
        </div>
        <p style="font-size:0.95rem; color:var(--text-main); opacity: 0.8; margin-bottom:15px;">–ù–∞–π–ø–æ–ø—É–ª—è—Ä–Ω—ñ—à–∏–π. –ù–µ –ø–æ—Ç—Ä–µ–±—É—î —Ç–µ—Ä–º–æ–∫–∞–º–µ—Ä–∏.</p>
        <div class="detail-item"><span>üå° –°–æ–ø–ª–æ:</span><strong>190 - 220 ¬∞C</strong></div>
        <div class="detail-item"><span>üõè –°—Ç—ñ–ª:</span><strong>50 - 60 ¬∞C</strong></div>
        <div class="detail-item"><span>üí® –û–±–¥—É–≤:</span><strong>100%</strong></div>
    </div>

    <div class="card" style="margin-bottom: 16px; border-left: 5px solid #0071e3;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
            <h3 style="margin:0;">PETG</h3>
            <span style="background:#e0f0ff; color:#0071e3; padding:4px 8px; border-radius:6px; font-size:0.8rem; font-weight:600;">–°–µ—Ä–µ–¥–Ω—ñ–π</span>
        </div>
        <p style="font-size:0.95rem; color:var(--text-main); opacity: 0.8; margin-bottom:15px;">–ó–æ–ª–æ—Ç–∞ —Å–µ—Ä–µ–¥–∏–Ω–∞. –ú—ñ—Ü–Ω–∏–π, –∞–ª–µ "—Å–æ–ø–ª–∏–≤–∏—Ç—å".</p>
        <div class="detail-item"><span>üå° –°–æ–ø–ª–æ:</span><strong>230 - 250 ¬∞C</strong></div>
        <div class="detail-item"><span>üõè –°—Ç—ñ–ª:</span><strong>70 - 80 ¬∞C</strong></div>
        <div class="detail-item"><span>üí® –û–±–¥—É–≤:</span><strong>30 - 50%</strong></div>
    </div>

    <div class="card" style="margin-bottom: 16px; border-left: 5px solid #ff3b30;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
            <h3 style="margin:0;">ABS / ASA</h3>
            <span style="background:#ffe5e3; color:#ff3b30; padding:4px 8px; border-radius:6px; font-size:0.8rem; font-weight:600;">–°–∫–ª–∞–¥–Ω–∏–π</span>
        </div>
        <p style="font-size:0.95rem; color:var(--text-main); opacity: 0.8; margin-bottom:15px;">–¢–µ—Ä–º–æ—Å—Ç—ñ–π–∫–∏–π. –ü–æ—Ç—Ä—ñ–±–Ω–∞ –∑–∞–∫—Ä–∏—Ç–∞ –∫–∞–º–µ—Ä–∞ (—É—Å–∞–¥–∫–∞).</p>
        <div class="detail-item"><span>üå° –°–æ–ø–ª–æ:</span><strong>240 - 260 ¬∞C</strong></div>
        <div class="detail-item"><span>üõè –°—Ç—ñ–ª:</span><strong>100 - 110 ¬∞C</strong></div>
        <div class="detail-item"><span>üí® –û–±–¥—É–≤:</span><strong>–í–∏–º–∫–Ω–µ–Ω–æ</strong></div>
    </div>

     <div class="card" style="margin-bottom: 16px; border-left: 5px solid #ff9500;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
            <h3 style="margin:0;">TPU</h3>
            <span style="background:#fff5e0; color:#ff9500; padding:4px 8px; border-radius:6px; font-size:0.8rem; font-weight:600;">–ì–Ω—É—á–∫–∏–π</span>
        </div>
        <p style="font-size:0.95rem; color:var(--text-main); opacity: 0.8; margin-bottom:15px;">–ì—É–º–æ–ø–æ–¥—ñ–±–Ω–∏–π. –î—Ä—É–∫—É–≤–∞—Ç–∏ –¥—É–∂–µ –ø–æ–≤—ñ–ª—å–Ω–æ.</p>
        <div class="detail-item"><span>üå° –°–æ–ø–ª–æ:</span><strong>200 - 220 ¬∞C</strong></div>
        <div class="detail-item"><span>üõè –°—Ç—ñ–ª:</span><strong>40 - 60 ¬∞C</strong></div>
    </div>
</div>

<script>
    const defaultPrices = {'PLA':800, 'PETG':750, 'ABS':1200, 'TPU':2500, 'Custom':1000};
    // –î–æ–¥–∞–≤ 'quantity' —É —Å–ø–∏—Å–æ–∫ –ø–æ–ª—ñ–≤, —è–∫—ñ —Ç—Ä–µ–±–∞ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏
    const fields = ['priceKwt', 'power', 'markup', 'weight', 'hours', 'materialType', 'quantity'];
    const tg = window.Telegram.WebApp;

    window.onload = () => {
        tg.ready(); tg.expand();
        if (tg.initDataUnsafe && Object.keys(tg.initDataUnsafe).length > 0 || tg.colorScheme) {
            document.body.classList.add('tg-mode');
            document.getElementById('themeBtn').style.display = 'none';
            tg.setHeaderColor('secondary_bg_color');
        } else if (localStorage.getItem('theme') === 'dark') {
            document.body.classList.add('dark-mode');
            document.getElementById('themeBtn').innerText = '‚òÄÔ∏è';
        }

        fields.forEach(id => {
            const saved = localStorage.getItem(id);
            if (saved) document.getElementById(id).value = saved;
        });
        loadMaterialPrice();

        tg.BackButton.onClick(() => switchTab('calc'));
    };

    function switchTab(tabId) {
        document.getElementById('tab-calc').style.display = 'none';
        document.getElementById('tab-lib').style.display = 'none';
        document.getElementById('btn-calc').className = 'tab-btn';
        document.getElementById('btn-lib').className = 'tab-btn';

        document.getElementById('tab-' + tabId).style.display = 'block';
        document.getElementById('btn-' + tabId).className = 'tab-btn active';

        if (tabId === 'calc') tg.BackButton.hide();
        else tg.BackButton.show();
        
        window.scrollTo(0,0);
    }

    function toggleTheme() {
        const isDark = document.body.classList.toggle('dark-mode');
        localStorage.setItem('theme', isDark ? 'dark' : 'light');
        document.getElementById('themeBtn').innerText = isDark ? '‚òÄÔ∏è' : 'üåô';
    }

    function toggleSettings() {
        document.getElementById('settingsContent').classList.toggle('active');
        document.getElementById('chevron').classList.toggle('active-chevron');
    }

    function loadMaterialPrice() {
        const select = document.getElementById('materialType');
        const type = select.value;
        const savedPrice = localStorage.getItem('price_' + type);
        document.getElementById('selected-material-label').innerText = type;
        document.getElementById('priceKg').value = savedPrice ? savedPrice : defaultPrices[type];
        localStorage.setItem('materialType', type);
        calculate();
    }

    function saveManualPrice() {
        const type = document.getElementById('materialType').value;
        localStorage.setItem('price_' + type, document.getElementById('priceKg').value);
        calculate();
    }

    function calculate() {
        const d = (id) => parseFloat(document.getElementById(id).value) || 0;
        fields.forEach(id => localStorage.setItem(id, document.getElementById(id).value));
        
        // –û—Ç—Ä–∏–º—É—î–º–æ –∫—ñ–ª—å–∫—ñ—Å—Ç—å (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º 1, —â–æ–± –Ω–µ –¥—ñ–ª–∏—Ç–∏ –Ω–∞ 0)
        let q = d('quantity');
        if (q < 1) q = 1;

        const cMat = (d('weight') / 1000) * d('priceKg');
        const cEn = (d('power') * d('hours') / 1000) * d('priceKwt');
        const cAmort = (cMat + cEn) * 0.10; // 10% –∞–º–æ—Ä—Ç–∏–∑–∞—Ü—ñ—ó
        const total = cMat + cEn + cAmort;
        const sell = total * (1 + d('markup') / 100);

        const fmt = (v) => v.toFixed(0) + ' ‚Ç¥';
        const fmtFull = (v) => v.toFixed(2) + ' ‚Ç¥';

        document.getElementById('res-material').innerText = fmtFull(cMat);
        document.getElementById('res-energy').innerText = fmtFull(cEn);
        document.getElementById('res-amortization').innerText = fmtFull(cAmort);

        // –õ–û–ì–Ü–ö–ê –í–Ü–î–û–ë–†–ê–ñ–ï–ù–ù–Ø –¶–Ü–ù–ò
        if (q > 1) {
            // –Ø–∫—â–æ –±—ñ–ª—å—à–µ 1 —à—Ç, –ø–æ–∫–∞–∑—É—î–º–æ –∑–∞–≥–∞–ª—å–Ω—É —Ü—ñ–Ω—É + —Ü—ñ–Ω—É –∑–∞ —à—Ç
            document.getElementById('total-cost').innerHTML = fmtFull(total) + `<span class="price-per-item">(${fmtFull(total/q)} / —à—Ç)</span>`;
            document.getElementById('sell-price').innerHTML = fmtFull(sell) + `<span class="price-per-item">(${fmtFull(sell/q)} / —à—Ç)</span>`;
            document.getElementById('profit').innerHTML = fmtFull(sell - total) + `<span class="price-per-item">(${fmtFull((sell - total)/q)} / —à—Ç)</span>`;
        } else {
            // –Ø–∫—â–æ 1 —à—Ç, –ø–æ–∫–∞–∑—É—î–º–æ —è–∫ —Ä–∞–Ω—ñ—à–µ
            document.getElementById('total-cost').innerText = fmtFull(total);
            document.getElementById('sell-price').innerText = fmtFull(sell);
            document.getElementById('profit').innerText = fmtFull(sell - total);
        }
    }
</script>
</body>
</html>
