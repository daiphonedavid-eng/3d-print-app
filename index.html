<!DOCTYPE html>
<html lang="uk">
<head>
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-20YWHMERD9"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-20YWHMERD9');
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>3D Print Expert Pro</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            /* –ë–∞–∑–æ–≤—ñ –∫–æ–ª—å–æ—Ä–∏ (—è–∫—â–æ –≤—ñ–¥–∫—Ä–∏—Ç–æ –ù–ï –≤ –¢–µ–ª–µ–≥—Ä–∞–º—ñ) */
            --bg-body: #f5f5f7;
            --bg-card: #ffffff;
            --bg-darker: #fafafa;
            --text-main: #1d1d1f;
            --text-muted: #86868b;
            --primary: #0071e3;
            --border: #d2d2d7;
            --card-radius: 12px;
        }

        /* –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑–º—ñ–Ω–Ω–∏—Ö –¢–µ–ª–µ–≥—Ä–∞–º—É */
        body.tg-mode {
            --bg-body: var(--tg-theme-bg-color, #f5f5f7);
            --bg-card: var(--tg-theme-secondary-bg-color, #ffffff);
            --bg-darker: var(--tg-theme-header-bg-color, #fafafa);
            --text-main: var(--tg-theme-text-color, #1d1d1f);
            --text-muted: var(--tg-theme-hint-color, #86868b);
            --primary: var(--tg-theme-button-color, #0071e3);
            --border: rgba(128, 128, 128, 0.2);
        }

        /* –¢–µ–º–Ω–∞ —Ç–µ–º–∞ (—Ñ–æ–ª–ª–±–µ–∫ –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–∞) */
        body.dark-mode {
            --bg-body: #000000;
            --bg-card: #1c1c1e;
            --bg-darker: #121212;
            --text-main: #f5f5f7;
            --text-muted: #86868b;
            --border: #38383a;
        }

        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background: var(--bg-body); 
            margin: 0; 
            /* –ó–º–µ–Ω—à–∏–≤ –≤—ñ–¥—Å—Ç—É–ø –∑–Ω–∏–∑—É, –±–æ –∫–Ω–æ–ø–∫–∏ –±—ñ–ª—å—à–µ –Ω–µ–º–∞—î */
            padding: 20px 16px 40px 16px; 
            color: var(--text-main);
            line-height: 1.4;
            transition: background 0.3s, color 0.3s;
            -webkit-tap-highlight-color: transparent;
        }

        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            /* –ü—Ä–∏—Ö–æ–≤–∞—î–º–æ –∫–Ω–æ–ø–∫—É, —è–∫—â–æ –º–∏ –≤ –¢–µ–ª–µ–≥—Ä–∞–º—ñ (—Ç–∞–º —Ç–µ–º–∞ –∞–≤—Ç–æ) */
            display: flex; 
        }

        .main-title { text-align: center; margin-bottom: 30px; font-weight: 600; letter-spacing: -0.5px; margin-top: 10px; }

        .dashboard { 
            display: grid; 
            grid-template-columns: 1fr; 
            gap: 16px; 
            max-width: 600px; 
            margin: 0 auto; 
        }

        .card { 
            background: var(--bg-card); 
            padding: 16px; 
            border-radius: var(--card-radius); 
            border: 1px solid var(--border);
            box-shadow: 0 2px 8px rgba(0,0,0,0.02);
        }

        .inputs-row {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }

        .input-group { 
            flex: 1 1 140px; 
            margin-bottom: 4px;
        }

        .settings-card {
            background: var(--bg-darker);
        }

        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            padding: 4px 0;
        }

        .settings-header h3 { font-size: 0.85rem; text-transform: uppercase; letter-spacing: 0.5px; color: var(--text-muted); margin: 0; }

        .settings-content {
            display: none;
            flex-wrap: wrap;
            gap: 12px;
            padding-top: 16px;
            margin-top: 12px;
            border-top: 1px solid var(--border);
        }

        .settings-content.active { display: flex; }

        h3 { margin-bottom: 12px; font-size: 1rem; font-weight: 600; }

        /* –°—Ç–∏–ª—ñ –¥–ª—è –Ω–æ–≤–æ–≥–æ —ñ–Ω—Ñ–æ-–±–ª–æ–∫—É */
        .info-card {
            background: var(--bg-darker); /* –¢—Ä–æ—Ö–∏ —Ç–µ–º–Ω—ñ—à–∏–π —Ñ–æ–Ω, —è–∫ —É –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å */
            font-size: 0.9rem;
        }
        .info-card h3 {
             margin-bottom: 8px;
             font-size: 0.95rem;
             display: flex; align-items: center; gap: 8px;
        }
        .info-card p {
            margin: 0 0 10px 0;
            color: var(--text-muted);
            line-height: 1.5;
        }
        .info-card p:last-child { margin-bottom: 0; }
        .info-card strong { color: var(--text-main); font-weight: 600; }


        label { display: block; margin-bottom: 6px; font-size: 0.75rem; font-weight: 500; color: var(--text-muted); }

        input, select { 
            width: 100%; 
            padding: 12px; 
            border: 1px solid var(--border); 
            border-radius: 10px; 
            background: var(--bg-card);
            color: var(--text-main);
            font-size: 1rem; /* –ë—ñ–ª—å—à–∏–π —à—Ä–∏—Ñ—Ç –¥–ª—è –º–æ–±—ñ–ª—å–Ω–∏—Ö */
            outline: none;
            box-sizing: border-box;
            appearance: none; /* –ü—Ä–∏–±–∏—Ä–∞—î —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ —Å—Ç–∏–ª—ñ –±—Ä–∞—É–∑–µ—Ä–∞ */
        }

        input:focus, select:focus { border-color: var(--primary); }

        .footer-container {
            display: grid; 
            grid-template-columns: 1fr;
            gap: 16px;
        }

        .detail-item { 
            display: flex; 
            justify-content: space-between; 
            padding: 6px 0;
            font-size: 0.9rem;
            border-bottom: 1px solid var(--border);
        }
        .detail-item:last-child { border-bottom: none; }

        .summary-card { 
            display: grid; 
            grid-template-columns: repeat(3, 1fr); 
            gap: 8px; 
            background: var(--text-main); 
            color: var(--bg-card); 
            padding: 20px;
            border-radius: var(--card-radius);
            align-items: center;
        }

        .stat-box { text-align: center; }
        .stat-box label { font-size: 0.7rem; opacity: 0.7; }
        .stat-box .price { font-size: 1.1rem; font-weight: 700; display: block; margin-top: 4px; }

        .stat-box.profit-box .price { color: #34c759; }
        
        /* –Ø–∫—â–æ —Ñ–æ–Ω —Ç–µ–º–Ω–∏–π (–≤ —Ç–µ–º–Ω—ñ–π —Ç–µ–º—ñ), —Ä–æ–±–∏–º–æ –∑–µ–ª–µ–Ω–∏–π —è—Å–∫—Ä–∞–≤—ñ—à–∏–º */
        body.dark-mode .stat-box.profit-box .price,
        body.tg-mode .stat-box.profit-box .price { color: #30d158; }

        .chevron::after { content: '‚Üì'; font-size: 0.8rem; margin-left: 8px; transition: transform 0.2s; display: inline-block; }
        .active-chevron::after { transform: rotate(180deg); }

    </style>
</head>
<body>

<button class="theme-toggle" onclick="toggleTheme()" id="themeBtn">üåô</button>

<h1 class="main-title">3D Print Studio</h1>

<div class="dashboard">
    
    <main class="card">
        <h3>–ü–∞—Ä–∞–º–µ—Ç—Ä–∏ –º–æ–¥–µ–ª—ñ</h3>
        <div class="inputs-row">
            <div class="input-group">
                <label>–ú–∞—Ç–µ—Ä—ñ–∞–ª</label>
                <select id="materialType" onchange="loadMaterialPrice()">
                    <option value="PLA">PLA</option>
                    <option value="PETG">PETG</option>
                    <option value="ABS">ABS / ASA</option>
                    <option value="TPU">TPU</option>
                    <option value="Custom">Custom</option>
                </select>
            </div>
            <div class="input-group">
                <label>–í–∞–≥–∞ (–≥)</label>
                <input type="number" inputmode="decimal" id="weight" oninput="calculate()" placeholder="0">
            </div>
            <div class="input-group">
                <label>–ß–∞—Å (–≥–æ–¥)</label>
                <input type="number" inputmode="decimal" id="hours" oninput="calculate()" placeholder="0">
            </div>
        </div>
    </main>

    <section class="card settings-card">
        <div class="settings-header" onclick="toggleSettings()">
            <h3>–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Ç–∞—Ä–∏—Ñ—ñ–≤ (<span id="selected-material-label">PLA</span>)</h3>
            <span id="chevron" class="chevron"></span>
        </div>
        <div id="settingsContent" class="settings-content">
            <div class="input-group">
                <label>–¶—ñ–Ω–∞ –∑–∞ –∫–≥ (‚Ç¥)</label>
                <input type="number" inputmode="decimal" id="priceKg" oninput="saveManualPrice()">
            </div>
            <div class="input-group">
                <label>–¢–∞—Ä–∏—Ñ –∫–í—Ç (‚Ç¥)</label>
                <input type="number" inputmode="decimal" id="priceKwt" oninput="calculate()">
            </div>
            <div class="input-group">
                <label>–ü–æ—Ç—É–∂–Ω—ñ—Å—Ç—å (–í—Ç)</label>
                <input type="number" inputmode="decimal" id="power" oninput="calculate()">
            </div>
            <div class="input-group">
                <label>–ù–∞—Ü—ñ–Ω–∫–∞ (%)</label>
                <input type="number" inputmode="decimal" id="markup" oninput="calculate()">
            </div>
        </div>
    </section>

    <section class="card info-card">
        <h3>‚ÑπÔ∏è –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ —Å–µ—Ä–≤—ñ—Å</h3>
        <p>
            –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –¥–æ–¥–∞—î <strong>3% –∞–º–æ—Ä—Ç–∏–∑–∞—Ü—ñ—ó</strong> –æ–±–ª–∞–¥–Ω–∞–Ω–Ω—è –¥–æ –≤–∞—Ä—Ç–æ—Å—Ç—ñ –º–∞—Ç–µ—Ä—ñ–∞–ª—ñ–≤ —Ç–∞ –µ–Ω–µ—Ä–≥—ñ—ó.
        </p>
        <p>
            –í—Å—ñ –ø–æ–∫–∞–∑–Ω–∏–∫–∏: —Ü—ñ–Ω—É –Ω–∞ –ø–ª–∞—Å—Ç–∏–∫, —Ç–∞—Ä–∏—Ñ –Ω–∞ —Å–≤—ñ—Ç–ª–æ, –ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å –ø—Ä–∏–Ω—Ç–µ—Ä–∞ —Ç–∞ –±–∞–∂–∞–Ω—É –Ω–∞—Ü—ñ–Ω–∫—É ‚Äî –≤–∏ –º–æ–∂–µ—Ç–µ –≤–ø–∏—Å–∞—Ç–∏ –≤—Ä—É—á–Ω—É –≤ –±–ª–æ—Ü—ñ "–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Ç–∞—Ä–∏—Ñ—ñ–≤" —ñ–Ω–¥–∏–≤—ñ–¥—É–∞–ª—å–Ω–æ.
        </p>
    </section>

    <div class="footer-container">
        <div class="card detail-card">
            <h3>–í–∏—Ç—Ä–∞—Ç–∏</h3>
            <div class="detail-item"><span>–ü–ª–∞—Å—Ç–∏–∫</span><span id="res-material" style="font-weight: 500;">0 ‚Ç¥</span></div>
            <div class="detail-item"><span>–ï–Ω–µ—Ä–≥—ñ—è</span><span id="res-energy" style="font-weight: 500;">0 ‚Ç¥</span></div>
            <div class="detail-item"><span>–ê–º–æ—Ä—Ç–∏–∑–∞—Ü—ñ—è (3%)</span><span id="res-amortization" style="font-weight: 500;">0 ‚Ç¥</span></div>
        </div>

        <div class="summary-card">
            <div class="stat-box"><label>–°–æ–±—ñ–≤–∞—Ä—Ç—ñ—Å—Ç—å</label><span id="total-cost" class="price">0 ‚Ç¥</span></div>
            <div class="stat-box"><label>–¶—ñ–Ω–∞ –ø—Ä–æ–¥–∞–∂—É</label><span id="sell-price" class="price">0 ‚Ç¥</span></div>
            <div class="stat-box profit-box"><label>–ü—Ä–∏–±—É—Ç–æ–∫</label><span id="profit" class="price">0 ‚Ç¥</span></div>
        </div>
    </div>
</div>

<script>
    const defaultPrices = {'PLA':800, 'PETG':750, 'ABS':1200, 'TPU':2500, 'Custom':1000};
    const fields = ['priceKwt', 'power', 'markup', 'weight', 'hours', 'materialType'];
    
    // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è Telegram WebApp
    const tg = window.Telegram.WebApp;

    window.onload = () => {
        // 1. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Telegram
        tg.ready(); // –ü–æ–≤—ñ–¥–æ–º–ª—è—î–º–æ, —â–æ –¥–æ–¥–∞—Ç–æ–∫ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏–≤—Å—è
        tg.expand(); // –†–æ–∑–≥–æ—Ä—Ç–∞—î–º–æ –Ω–∞ –≤–µ—Å—å –µ–∫—Ä–∞–Ω

        // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ –º–∏ –≤ –¢–µ–ª–µ–≥—Ä–∞–º—ñ
        if (tg.initDataUnsafe && Object.keys(tg.initDataUnsafe).length > 0 || tg.colorScheme) {
            document.body.classList.add('tg-mode');
            document.getElementById('themeBtn').style.display = 'none'; // –•–æ–≤–∞—î–º–æ –∫–Ω–æ–ø–∫—É –≤ –¢–ì
            
            // –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∫–æ–ª—å–æ—Ä—É —Ö–µ–¥–µ—Ä–∞ (—à—Ç–æ—Ä–∫–∏)
            tg.setHeaderColor('secondary_bg_color'); 
        } else {
            // –ó–≤–∏—á–∞–π–Ω–∞ –ª–æ–≥—ñ–∫–∞ –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–∞
            if (localStorage.getItem('theme') === 'dark') {
                document.body.classList.add('dark-mode');
                document.getElementById('themeBtn').innerText = '‚òÄÔ∏è';
            }
        }

        // 2. –í—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö
        fields.forEach(id => {
            const saved = localStorage.getItem(id);
            if (saved) document.getElementById(id).value = saved;
        });
        loadMaterialPrice();

        // –í–ò–î–ê–õ–ï–ù–û: –ë–ª–æ–∫ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è MainButton
    };

    function toggleTheme() {
        const isDark = document.body.classList.toggle('dark-mode');
        localStorage.setItem('theme', isDark ? 'dark' : 'light');
        document.getElementById('themeBtn').innerText = isDark ? '‚òÄÔ∏è' : 'üåô';
    }

    function toggleSettings() {
        document.getElementById('settingsContent').classList.toggle('active');
        document.getElementById('chevron').classList.toggle('active-chevron');
    }

    function loadMaterialPrice() {
        const select = document.getElementById('materialType');
        const type = select.value;
        const savedPrice = localStorage.getItem('price_' + type);
        document.getElementById('selected-material-label').innerText = type;
        document.getElementById('priceKg').value = savedPrice ? savedPrice : defaultPrices[type];
        localStorage.setItem('materialType', type);
        calculate();
    }

    function saveManualPrice() {
        const type = document.getElementById('materialType').value;
        localStorage.setItem('price_' + type, document.getElementById('priceKg').value);
        calculate();
    }

    function calculate() {
        const d = (id) => parseFloat(document.getElementById(id).value) || 0;
        fields.forEach(id => localStorage.setItem(id, document.getElementById(id).value));

        const cMat = (d('weight') / 1000) * d('priceKg');
        const cEn = (d('power') * d('hours') / 1000) * d('priceKwt');
        const cAmort = (cMat + cEn) * 0.03;
        const total = cMat + cEn + cAmort;
        const sell = total * (1 + d('markup') / 100);

        const fmt = (v) => v.toFixed(0) + ' ‚Ç¥'; // –ü—Ä–∏–±—Ä–∞–≤ –∫–æ–ø—ñ–π–∫–∏ –¥–ª—è —á–∏—Å—Ç–æ—Ç–∏ UI
        const fmtFull = (v) => v.toFixed(2) + ' ‚Ç¥';

        document.getElementById('res-material').innerText = fmtFull(cMat);
        document.getElementById('res-energy').innerText = fmtFull(cEn);
        document.getElementById('res-amortization').innerText = fmtFull(cAmort);
        document.getElementById('total-cost').innerText = fmtFull(total);
        document.getElementById('sell-price').innerText = fmtFull(sell);
        document.getElementById('profit').innerText = fmtFull(sell - total);

        // –í–ò–î–ê–õ–ï–ù–û: –õ–æ–≥—ñ–∫–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è MainButton
    }
</script>
</body>
</html>
